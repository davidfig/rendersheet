<head>
    <script src="https://rawgit.com/pixijs/pixi.js/dev/bin/pixi.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/ascetic.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>

    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

    <script src="https://rawgit.com/davidfig/rendersheet/master/rendersheet.js"></script>
    <script src="https://rawgit.com/davidfig/debug/master/debug.js"></script>
    <!--for local testing-->

    <!--<script src="../debug/debug.js"></script>
    <script src="../rendersheet/rendersheet.js"></script>-->
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        .title {
            margin-top: 1%;
            margin-left: 15%;
            font-size: 200%;
        }
        #code {
            left: 15%;
            position: absolute;
            word-wrap: break-word;
            z-index: -1;
        }
    </style>
</head>
<body>
    <div class="title">Example for <a href="https://github.com/davidfig/rendersheet/">github.com/davidfig/rendersheet/</a></div>
    <pre><code class="javascript" id="code"></code></pre>
    <script id="sample">

        Debug.init();

        // set up rendersheet
        var resolution = window.devicePixelRatio;
        var sheet = new RenderSheet({width: 2048, height: 2048, resolution: resolution});

        // number for triangle
        var n = 0;

        // draw triangle textures on rendersheet
        var count = 200;
        for (var i = 0; i < count; i++)
        {
            sheet.add('triangle_' + i, triangleDraw, triangleMeasure, {size: Math.random() * 500, color: Math.round(Math.random() * 0xffffff)});
        }
        sheet.render();

        // show the rendersheet (for debug purposes)
        sheet.show({opacity: 0.5, pointerEvents: 'none'});

        // set up pixi
        var renderer, stage, width, height;
        pixi();

        // add a sprite
        var sprite = new PIXI.Sprite();
        sprite.anchor.set(0.5);
        stage.addChild(sprite);
        sprite.x = width / 2;
        sprite.y = height / 2;

        // change the texture of the sprite to a texture from the rendersheet
        setInterval(function()
            {
                sprite.texture = sheet.getTexture('triangle_' + Math.floor(Math.random() * count));
                renderer.render(stage);
            }, 200);

        // initialize pixi
        function pixi()
        {
            var w = window,
                d = document,
                e = d.documentElement,
                g = d.getElementsByTagName('body')[0];
            width = w.innerWidth || e.clientWidth || g.clientWidth;
            height = w.innerHeight|| e.clientHeight|| g.clientHeight;
            renderer = new PIXI.WebGLRenderer(width, height, {transparent: true, resolution: resolution});
            document.body.appendChild(renderer.view);
            renderer.view.style.position = 'absolute';
            renderer.view.style.top = renderer.view.style.left = '0px';
            renderer.view.style.pointerEvents = 'none';
            renderer.view.style.width = width + 'px';
            renderer.view.style.height = height + 'px';
            stage = new PIXI.Container();
        }

        // draw a triangle to the render sheet using canvas
        function triangleDraw(c, params)
        {
            var size = params.size;
            var half = params.size / 2;
            c.beginPath();
            c.fillStyle = '#' + params.color.toString(16);
            c.moveTo(half, 0);
            c.lineTo(0, size);
            c.lineTo(size, size);
            c.closePath();
            c.fill();
            c.fillStyle = 'white';
            var measure = c.measureText(n);
            c.fillText(n++, size / 2 - measure.width / 2, size / 2 + 10);
        }

        // returns the size of the drawn texture
        function triangleMeasure(c, params)
        {
            return {width: params.size, height: params.size};
        }

    </script>
    <script>
        window.onload = function()
        {
            var code = document.getElementById('code');
            var script = document.getElementById('sample');
            code.innerHTML = script.innerHTML;
            hljs.highlightBlock(code);
        };
    </script>
</body>